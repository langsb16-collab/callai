var wt=Object.defineProperty;var ke=t=>{throw TypeError(t)};var yt=(t,e,r)=>e in t?wt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var p=(t,e,r)=>yt(t,typeof e!="symbol"?e+"":e,r),Ie=(t,e,r)=>e.has(t)||ke("Cannot "+r);var o=(t,e,r)=>(Ie(t,e,"read from private field"),r?r.call(t):e.get(t)),g=(t,e,r)=>e.has(t)?ke("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),d=(t,e,r,s)=>(Ie(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r),y=(t,e,r)=>(Ie(t,e,"access private method"),r);var Fe=(t,e,r,s)=>({set _(n){d(t,e,n,r)},get _(){return o(t,e,s)}});var qe=(t,e,r)=>(s,n)=>{let i=-1;return a(0);async function a(h){if(h<=i)throw new Error("next() called multiple times");i=h;let c,l=!1,u;if(t[h]?(u=t[h][0][0],s.req.routeIndex=h):u=h===t.length&&n||void 0,u)try{c=await u(s,()=>a(h+1))}catch(f){if(f instanceof Error&&e)s.error=f,c=await e(f,s),l=!0;else throw f}else s.finalized===!1&&r&&(c=await r(s));return c&&(s.finalized===!1||l)&&(s.res=c),s}},mt=Symbol(),vt=async(t,e=Object.create(null))=>{const{all:r=!1,dot:s=!1}=e,i=(t instanceof rt?t.raw.headers:t.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?xt(t,{all:r,dot:s}):{}};async function xt(t,e){const r=await t.formData();return r?Rt(r,e):{}}function Rt(t,e){const r=Object.create(null);return t.forEach((s,n)=>{e.all||n.endsWith("[]")?Et(r,n,s):r[n]=s}),e.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(Ot(r,s,n),delete r[s])}),r}var Et=(t,e,r)=>{t[e]!==void 0?Array.isArray(t[e])?t[e].push(r):t[e]=[t[e],r]:e.endsWith("[]")?t[e]=[r]:t[e]=r},Ot=(t,e,r)=>{let s=t;const n=e.split(".");n.forEach((i,a)=>{a===n.length-1?s[i]=r:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})},Qe=t=>{const e=t.split("/");return e[0]===""&&e.shift(),e},bt=t=>{const{groups:e,path:r}=jt(t),s=Qe(r);return Pt(s,e)},jt=t=>{const e=[];return t=t.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return e.push([n,r]),n}),{groups:e,path:t}},Pt=(t,e)=>{for(let r=e.length-1;r>=0;r--){const[s]=e[r];for(let n=t.length-1;n>=0;n--)if(t[n].includes(s)){t[n]=t[n].replace(s,e[r][1]);break}}return t},je={},At=(t,e)=>{if(t==="*")return"*";const r=t.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${t}#${e}`;return je[s]||(r[2]?je[s]=e&&e[0]!==":"&&e[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${e})`)]:[t,r[1],new RegExp(`^${r[2]}$`)]:je[s]=[t,r[1],!0]),je[s]}return null},Ne=(t,e)=>{try{return e(t)}catch{return t.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return e(r)}catch{return r}})}},Ct=t=>Ne(t,decodeURI),Ye=t=>{const e=t.url,r=e.indexOf("/",e.indexOf(":")+4);let s=r;for(;s<e.length;s++){const n=e.charCodeAt(s);if(n===37){const i=e.indexOf("?",s),a=e.slice(r,i===-1?void 0:i);return Ct(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(n===63)break}return e.slice(r,s)},Ht=t=>{const e=Ye(t);return e.length>1&&e.at(-1)==="/"?e.slice(0,-1):e},se=(t,e,...r)=>(r.length&&(e=se(e,...r)),`${(t==null?void 0:t[0])==="/"?"":"/"}${t}${e==="/"?"":`${(t==null?void 0:t.at(-1))==="/"?"":"/"}${(e==null?void 0:e[0])==="/"?e.slice(1):e}`}`),Ze=t=>{if(t.charCodeAt(t.length-1)!==63||!t.includes(":"))return null;const e=t.split("/"),r=[];let s="";return e.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);const i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,a)=>a.indexOf(n)===i)},Te=t=>/[%+]/.test(t)?(t.indexOf("+")!==-1&&(t=t.replace(/\+/g," ")),t.indexOf("%")!==-1?Ne(t,tt):t):t,et=(t,e,r)=>{let s;if(!r&&e&&!/[%+]/.test(e)){let a=t.indexOf("?",8);if(a===-1)return;for(t.startsWith(e,a+1)||(a=t.indexOf(`&${e}`,a+1));a!==-1;){const h=t.charCodeAt(a+e.length+1);if(h===61){const c=a+e.length+2,l=t.indexOf("&",c);return Te(t.slice(c,l===-1?void 0:l))}else if(h==38||isNaN(h))return"";a=t.indexOf(`&${e}`,a+1)}if(s=/[%+]/.test(t),!s)return}const n={};s??(s=/[%+]/.test(t));let i=t.indexOf("?",8);for(;i!==-1;){const a=t.indexOf("&",i+1);let h=t.indexOf("=",i);h>a&&a!==-1&&(h=-1);let c=t.slice(i+1,h===-1?a===-1?void 0:a:h);if(s&&(c=Te(c)),i=a,c==="")continue;let l;h===-1?l="":(l=t.slice(h+1,a===-1?void 0:a),s&&(l=Te(l))),r?(n[c]&&Array.isArray(n[c])||(n[c]=[]),n[c].push(l)):n[c]??(n[c]=l)}return e?n[e]:n},St=et,$t=(t,e)=>et(t,e,!0),tt=decodeURIComponent,Ue=t=>Ne(t,tt),oe,A,N,st,nt,_e,q,Be,rt=(Be=class{constructor(t,e="/",r=[[]]){g(this,N);p(this,"raw");g(this,oe);g(this,A);p(this,"routeIndex",0);p(this,"path");p(this,"bodyCache",{});g(this,q,t=>{const{bodyCache:e,raw:r}=this,s=e[t];if(s)return s;const n=Object.keys(e)[0];return n?e[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[t]())):e[t]=r[t]()});this.raw=t,this.path=e,d(this,A,r),d(this,oe,{})}param(t){return t?y(this,N,st).call(this,t):y(this,N,nt).call(this)}query(t){return St(this.url,t)}queries(t){return $t(this.url,t)}header(t){if(t)return this.raw.headers.get(t)??void 0;const e={};return this.raw.headers.forEach((r,s)=>{e[s]=r}),e}async parseBody(t){var e;return(e=this.bodyCache).parsedBody??(e.parsedBody=await vt(this,t))}json(){return o(this,q).call(this,"text").then(t=>JSON.parse(t))}text(){return o(this,q).call(this,"text")}arrayBuffer(){return o(this,q).call(this,"arrayBuffer")}blob(){return o(this,q).call(this,"blob")}formData(){return o(this,q).call(this,"formData")}addValidatedData(t,e){o(this,oe)[t]=e}valid(t){return o(this,oe)[t]}get url(){return this.raw.url}get method(){return this.raw.method}get[mt](){return o(this,A)}get matchedRoutes(){return o(this,A)[0].map(([[,t]])=>t)}get routePath(){return o(this,A)[0].map(([[,t]])=>t)[this.routeIndex].path}},oe=new WeakMap,A=new WeakMap,N=new WeakSet,st=function(t){const e=o(this,A)[0][this.routeIndex][1][t],r=y(this,N,_e).call(this,e);return r&&/\%/.test(r)?Ue(r):r},nt=function(){const t={},e=Object.keys(o(this,A)[0][this.routeIndex][1]);for(const r of e){const s=y(this,N,_e).call(this,o(this,A)[0][this.routeIndex][1][r]);s!==void 0&&(t[r]=/\%/.test(s)?Ue(s):s)}return t},_e=function(t){return o(this,A)[1]?o(this,A)[1][t]:t},q=new WeakMap,Be),Dt={Stringify:1},it=async(t,e,r,s,n)=>{typeof t=="object"&&!(t instanceof String)&&(t instanceof Promise||(t=t.toString()),t instanceof Promise&&(t=await t));const i=t.callbacks;return i!=null&&i.length?(n?n[0]+=t:n=[t],Promise.all(i.map(h=>h({phase:e,buffer:n,context:s}))).then(h=>Promise.all(h.filter(Boolean).map(c=>it(c,e,!1,s,n))).then(()=>n[0]))):Promise.resolve(t)},It="text/plain; charset=UTF-8",Le=(t,e)=>({"Content-Type":t,...e}),ye,me,I,ae,T,j,ve,ce,le,X,xe,Re,U,ne,Ve,Tt=(Ve=class{constructor(t,e){g(this,U);g(this,ye);g(this,me);p(this,"env",{});g(this,I);p(this,"finalized",!1);p(this,"error");g(this,ae);g(this,T);g(this,j);g(this,ve);g(this,ce);g(this,le);g(this,X);g(this,xe);g(this,Re);p(this,"render",(...t)=>(o(this,ce)??d(this,ce,e=>this.html(e)),o(this,ce).call(this,...t)));p(this,"setLayout",t=>d(this,ve,t));p(this,"getLayout",()=>o(this,ve));p(this,"setRenderer",t=>{d(this,ce,t)});p(this,"header",(t,e,r)=>{this.finalized&&d(this,j,new Response(o(this,j).body,o(this,j)));const s=o(this,j)?o(this,j).headers:o(this,X)??d(this,X,new Headers);e===void 0?s.delete(t):r!=null&&r.append?s.append(t,e):s.set(t,e)});p(this,"status",t=>{d(this,ae,t)});p(this,"set",(t,e)=>{o(this,I)??d(this,I,new Map),o(this,I).set(t,e)});p(this,"get",t=>o(this,I)?o(this,I).get(t):void 0);p(this,"newResponse",(...t)=>y(this,U,ne).call(this,...t));p(this,"body",(t,e,r)=>y(this,U,ne).call(this,t,e,r));p(this,"text",(t,e,r)=>!o(this,X)&&!o(this,ae)&&!e&&!r&&!this.finalized?new Response(t):y(this,U,ne).call(this,t,e,Le(It,r)));p(this,"json",(t,e,r)=>y(this,U,ne).call(this,JSON.stringify(t),e,Le("application/json",r)));p(this,"html",(t,e,r)=>{const s=n=>y(this,U,ne).call(this,n,e,Le("text/html; charset=UTF-8",r));return typeof t=="object"?it(t,Dt.Stringify,!1,{}).then(s):s(t)});p(this,"redirect",(t,e)=>{const r=String(t);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,e??302)});p(this,"notFound",()=>(o(this,le)??d(this,le,()=>new Response),o(this,le).call(this,this)));d(this,ye,t),e&&(d(this,T,e.executionCtx),this.env=e.env,d(this,le,e.notFoundHandler),d(this,Re,e.path),d(this,xe,e.matchResult))}get req(){return o(this,me)??d(this,me,new rt(o(this,ye),o(this,Re),o(this,xe))),o(this,me)}get event(){if(o(this,T)&&"respondWith"in o(this,T))return o(this,T);throw Error("This context has no FetchEvent")}get executionCtx(){if(o(this,T))return o(this,T);throw Error("This context has no ExecutionContext")}get res(){return o(this,j)||d(this,j,new Response(null,{headers:o(this,X)??d(this,X,new Headers)}))}set res(t){if(o(this,j)&&t){t=new Response(t.body,t);for(const[e,r]of o(this,j).headers.entries())if(e!=="content-type")if(e==="set-cookie"){const s=o(this,j).headers.getSetCookie();t.headers.delete("set-cookie");for(const n of s)t.headers.append("set-cookie",n)}else t.headers.set(e,r)}d(this,j,t),this.finalized=!0}get var(){return o(this,I)?Object.fromEntries(o(this,I)):{}}},ye=new WeakMap,me=new WeakMap,I=new WeakMap,ae=new WeakMap,T=new WeakMap,j=new WeakMap,ve=new WeakMap,ce=new WeakMap,le=new WeakMap,X=new WeakMap,xe=new WeakMap,Re=new WeakMap,U=new WeakSet,ne=function(t,e,r){const s=o(this,j)?new Headers(o(this,j).headers):o(this,X)??new Headers;if(typeof e=="object"&&"headers"in e){const i=e.headers instanceof Headers?e.headers:new Headers(e.headers);for(const[a,h]of i)a.toLowerCase()==="set-cookie"?s.append(a,h):s.set(a,h)}if(r)for(const[i,a]of Object.entries(r))if(typeof a=="string")s.set(i,a);else{s.delete(i);for(const h of a)s.append(i,h)}const n=typeof e=="number"?e:(e==null?void 0:e.status)??o(this,ae);return new Response(t,{status:n,headers:s})},Ve),x="ALL",Lt="all",_t=["get","post","put","delete","options","patch"],ot="Can not add a route since the matcher is already built.",at=class extends Error{},Nt="__COMPOSED_HANDLER",Mt=t=>t.text("404 Not Found",404),We=(t,e)=>{if("getResponse"in t){const r=t.getResponse();return e.newResponse(r.body,r)}return console.error(t),e.text("Internal Server Error",500)},C,R,ct,H,z,Pe,Ae,he,kt=(he=class{constructor(e={}){g(this,R);p(this,"get");p(this,"post");p(this,"put");p(this,"delete");p(this,"options");p(this,"patch");p(this,"all");p(this,"on");p(this,"use");p(this,"router");p(this,"getPath");p(this,"_basePath","/");g(this,C,"/");p(this,"routes",[]);g(this,H,Mt);p(this,"errorHandler",We);p(this,"onError",e=>(this.errorHandler=e,this));p(this,"notFound",e=>(d(this,H,e),this));p(this,"fetch",(e,...r)=>y(this,R,Ae).call(this,e,r[1],r[0],e.method));p(this,"request",(e,r,s,n)=>e instanceof Request?this.fetch(r?new Request(e,r):e,s,n):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${se("/",e)}`,r),s,n)));p(this,"fire",()=>{addEventListener("fetch",e=>{e.respondWith(y(this,R,Ae).call(this,e.request,e,void 0,e.request.method))})});[..._t,Lt].forEach(i=>{this[i]=(a,...h)=>(typeof a=="string"?d(this,C,a):y(this,R,z).call(this,i,o(this,C),a),h.forEach(c=>{y(this,R,z).call(this,i,o(this,C),c)}),this)}),this.on=(i,a,...h)=>{for(const c of[a].flat()){d(this,C,c);for(const l of[i].flat())h.map(u=>{y(this,R,z).call(this,l.toUpperCase(),o(this,C),u)})}return this},this.use=(i,...a)=>(typeof i=="string"?d(this,C,i):(d(this,C,"*"),a.unshift(i)),a.forEach(h=>{y(this,R,z).call(this,x,o(this,C),h)}),this);const{strict:s,...n}=e;Object.assign(this,n),this.getPath=s??!0?e.getPath??Ye:Ht}route(e,r){const s=this.basePath(e);return r.routes.map(n=>{var a;let i;r.errorHandler===We?i=n.handler:(i=async(h,c)=>(await qe([],r.errorHandler)(h,()=>n.handler(h,c))).res,i[Nt]=n.handler),y(a=s,R,z).call(a,n.method,n.path,i)}),this}basePath(e){const r=y(this,R,ct).call(this);return r._basePath=se(this._basePath,e),r}mount(e,r,s){let n,i;s&&(typeof s=="function"?i=s:(i=s.optionHandler,s.replaceRequest===!1?n=c=>c:n=s.replaceRequest));const a=i?c=>{const l=i(c);return Array.isArray(l)?l:[l]}:c=>{let l;try{l=c.executionCtx}catch{}return[c.env,l]};n||(n=(()=>{const c=se(this._basePath,e),l=c==="/"?0:c.length;return u=>{const f=new URL(u.url);return f.pathname=f.pathname.slice(l)||"/",new Request(f,u)}})());const h=async(c,l)=>{const u=await r(n(c.req.raw),...a(c));if(u)return u;await l()};return y(this,R,z).call(this,x,se(e,"*"),h),this}},C=new WeakMap,R=new WeakSet,ct=function(){const e=new he({router:this.router,getPath:this.getPath});return e.errorHandler=this.errorHandler,d(e,H,o(this,H)),e.routes=this.routes,e},H=new WeakMap,z=function(e,r,s){e=e.toUpperCase(),r=se(this._basePath,r);const n={basePath:this._basePath,path:r,method:e,handler:s};this.router.add(e,r,[s,n]),this.routes.push(n)},Pe=function(e,r){if(e instanceof Error)return this.errorHandler(e,r);throw e},Ae=function(e,r,s,n){if(n==="HEAD")return(async()=>new Response(null,await y(this,R,Ae).call(this,e,r,s,"GET")))();const i=this.getPath(e,{env:s}),a=this.router.match(n,i),h=new Tt(e,{path:i,matchResult:a,env:s,executionCtx:r,notFoundHandler:o(this,H)});if(a[0].length===1){let l;try{l=a[0][0][0][0](h,async()=>{h.res=await o(this,H).call(this,h)})}catch(u){return y(this,R,Pe).call(this,u,h)}return l instanceof Promise?l.then(u=>u||(h.finalized?h.res:o(this,H).call(this,h))).catch(u=>y(this,R,Pe).call(this,u,h)):l??o(this,H).call(this,h)}const c=qe(a[0],this.errorHandler,o(this,H));return(async()=>{try{const l=await c(h);if(!l.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return l.res}catch(l){return y(this,R,Pe).call(this,l,h)}})()},he),lt=[];function Ft(t,e){const r=this.buildAllMatchers(),s=((n,i)=>{const a=r[n]||r[x],h=a[2][i];if(h)return h;const c=i.match(a[0]);if(!c)return[[],lt];const l=c.indexOf("",1);return[a[1][l],c]});return this.match=s,s(t,e)}var He="[^/]+",ge=".*",we="(?:|/.*)",ie=Symbol(),qt=new Set(".\\+*[^]$()");function Ut(t,e){return t.length===1?e.length===1?t<e?-1:1:-1:e.length===1||t===ge||t===we?1:e===ge||e===we?-1:t===He?1:e===He?-1:t.length===e.length?t<e?-1:1:e.length-t.length}var J,Q,S,ee,Wt=(ee=class{constructor(){g(this,J);g(this,Q);g(this,S,Object.create(null))}insert(e,r,s,n,i){if(e.length===0){if(o(this,J)!==void 0)throw ie;if(i)return;d(this,J,r);return}const[a,...h]=e,c=a==="*"?h.length===0?["","",ge]:["","",He]:a==="/*"?["","",we]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let l;if(c){const u=c[1];let f=c[2]||He;if(u&&c[2]&&(f===".*"||(f=f.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(f))))throw ie;if(l=o(this,S)[f],!l){if(Object.keys(o(this,S)).some(w=>w!==ge&&w!==we))throw ie;if(i)return;l=o(this,S)[f]=new ee,u!==""&&d(l,Q,n.varIndex++)}!i&&u!==""&&s.push([u,o(l,Q)])}else if(l=o(this,S)[a],!l){if(Object.keys(o(this,S)).some(u=>u.length>1&&u!==ge&&u!==we))throw ie;if(i)return;l=o(this,S)[a]=new ee}l.insert(h,r,s,n,i)}buildRegExpStr(){const r=Object.keys(o(this,S)).sort(Ut).map(s=>{const n=o(this,S)[s];return(typeof o(n,Q)=="number"?`(${s})@${o(n,Q)}`:qt.has(s)?`\\${s}`:s)+n.buildRegExpStr()});return typeof o(this,J)=="number"&&r.unshift(`#${o(this,J)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},J=new WeakMap,Q=new WeakMap,S=new WeakMap,ee),Se,Ee,ze,Kt=(ze=class{constructor(){g(this,Se,{varIndex:0});g(this,Ee,new Wt)}insert(t,e,r){const s=[],n=[];for(let a=0;;){let h=!1;if(t=t.replace(/\{[^}]+\}/g,c=>{const l=`@\\${a}`;return n[a]=[l,c],a++,h=!0,l}),!h)break}const i=t.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){const[h]=n[a];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(h)!==-1){i[c]=i[c].replace(h,n[a][1]);break}}return o(this,Ee).insert(i,e,s,o(this,Se),r),s}buildRegExp(){let t=o(this,Ee).buildRegExpStr();if(t==="")return[/^$/,[],[]];let e=0;const r=[],s=[];return t=t.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,a)=>i!==void 0?(r[++e]=Number(i),"$()"):(a!==void 0&&(s[Number(a)]=++e),"")),[new RegExp(`^${t}`),r,s]}},Se=new WeakMap,Ee=new WeakMap,ze),Bt=[/^$/,[],Object.create(null)],Ce=Object.create(null);function ht(t){return Ce[t]??(Ce[t]=new RegExp(t==="*"?"":`^${t.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Vt(){Ce=Object.create(null)}function zt(t){var l;const e=new Kt,r=[];if(t.length===0)return Bt;const s=t.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,f],[w,v])=>u?1:w?-1:f.length-v.length),n=Object.create(null);for(let u=0,f=-1,w=s.length;u<w;u++){const[v,P,M]=s[u];v?n[P]=[M.map(([b])=>[b,Object.create(null)]),lt]:f++;let m;try{m=e.insert(P,f,v)}catch(b){throw b===ie?new at(P):b}v||(r[f]=M.map(([b,k])=>{const Oe=Object.create(null);for(k-=1;k>=0;k--){const[be,$]=m[k];Oe[be]=$}return[b,Oe]}))}const[i,a,h]=e.buildRegExp();for(let u=0,f=r.length;u<f;u++)for(let w=0,v=r[u].length;w<v;w++){const P=(l=r[u][w])==null?void 0:l[1];if(!P)continue;const M=Object.keys(P);for(let m=0,b=M.length;m<b;m++)P[M[m]]=h[P[M[m]]]}const c=[];for(const u in a)c[u]=r[a[u]];return[i,c,n]}function re(t,e){if(t){for(const r of Object.keys(t).sort((s,n)=>n.length-s.length))if(ht(r).test(e))return[...t[r]]}}var W,K,$e,ut,Ge,Gt=(Ge=class{constructor(){g(this,$e);p(this,"name","RegExpRouter");g(this,W);g(this,K);p(this,"match",Ft);d(this,W,{[x]:Object.create(null)}),d(this,K,{[x]:Object.create(null)})}add(t,e,r){var h;const s=o(this,W),n=o(this,K);if(!s||!n)throw new Error(ot);s[t]||[s,n].forEach(c=>{c[t]=Object.create(null),Object.keys(c[x]).forEach(l=>{c[t][l]=[...c[x][l]]})}),e==="/*"&&(e="*");const i=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){const c=ht(e);t===x?Object.keys(s).forEach(l=>{var u;(u=s[l])[e]||(u[e]=re(s[l],e)||re(s[x],e)||[])}):(h=s[t])[e]||(h[e]=re(s[t],e)||re(s[x],e)||[]),Object.keys(s).forEach(l=>{(t===x||t===l)&&Object.keys(s[l]).forEach(u=>{c.test(u)&&s[l][u].push([r,i])})}),Object.keys(n).forEach(l=>{(t===x||t===l)&&Object.keys(n[l]).forEach(u=>c.test(u)&&n[l][u].push([r,i]))});return}const a=Ze(e)||[e];for(let c=0,l=a.length;c<l;c++){const u=a[c];Object.keys(n).forEach(f=>{var w;(t===x||t===f)&&((w=n[f])[u]||(w[u]=[...re(s[f],u)||re(s[x],u)||[]]),n[f][u].push([r,i-l+c+1]))})}}buildAllMatchers(){const t=Object.create(null);return Object.keys(o(this,K)).concat(Object.keys(o(this,W))).forEach(e=>{t[e]||(t[e]=y(this,$e,ut).call(this,e))}),d(this,W,d(this,K,void 0)),Vt(),t}},W=new WeakMap,K=new WeakMap,$e=new WeakSet,ut=function(t){const e=[];let r=t===x;return[o(this,W),o(this,K)].forEach(s=>{const n=s[t]?Object.keys(s[t]).map(i=>[i,s[t][i]]):[];n.length!==0?(r||(r=!0),e.push(...n)):t!==x&&e.push(...Object.keys(s[x]).map(i=>[i,s[x][i]]))}),r?zt(e):null},Ge),B,L,Xe,Xt=(Xe=class{constructor(t){p(this,"name","SmartRouter");g(this,B,[]);g(this,L,[]);d(this,B,t.routers)}add(t,e,r){if(!o(this,L))throw new Error(ot);o(this,L).push([t,e,r])}match(t,e){if(!o(this,L))throw new Error("Fatal error");const r=o(this,B),s=o(this,L),n=r.length;let i=0,a;for(;i<n;i++){const h=r[i];try{for(let c=0,l=s.length;c<l;c++)h.add(...s[c]);a=h.match(t,e)}catch(c){if(c instanceof at)continue;throw c}this.match=h.match.bind(h),d(this,B,[h]),d(this,L,void 0);break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(o(this,L)||o(this,B).length!==1)throw new Error("No active router has been determined yet.");return o(this,B)[0]}},B=new WeakMap,L=new WeakMap,Xe),pe=Object.create(null),V,O,Y,ue,E,_,G,fe,Jt=(fe=class{constructor(e,r,s){g(this,_);g(this,V);g(this,O);g(this,Y);g(this,ue,0);g(this,E,pe);if(d(this,O,s||Object.create(null)),d(this,V,[]),e&&r){const n=Object.create(null);n[e]={handler:r,possibleKeys:[],score:0},d(this,V,[n])}d(this,Y,[])}insert(e,r,s){d(this,ue,++Fe(this,ue)._);let n=this;const i=bt(r),a=[];for(let h=0,c=i.length;h<c;h++){const l=i[h],u=i[h+1],f=At(l,u),w=Array.isArray(f)?f[0]:l;if(w in o(n,O)){n=o(n,O)[w],f&&a.push(f[1]);continue}o(n,O)[w]=new fe,f&&(o(n,Y).push(f),a.push(f[1])),n=o(n,O)[w]}return o(n,V).push({[e]:{handler:s,possibleKeys:a.filter((h,c,l)=>l.indexOf(h)===c),score:o(this,ue)}}),n}search(e,r){var c;const s=[];d(this,E,pe);let i=[this];const a=Qe(r),h=[];for(let l=0,u=a.length;l<u;l++){const f=a[l],w=l===u-1,v=[];for(let P=0,M=i.length;P<M;P++){const m=i[P],b=o(m,O)[f];b&&(d(b,E,o(m,E)),w?(o(b,O)["*"]&&s.push(...y(this,_,G).call(this,o(b,O)["*"],e,o(m,E))),s.push(...y(this,_,G).call(this,b,e,o(m,E)))):v.push(b));for(let k=0,Oe=o(m,Y).length;k<Oe;k++){const be=o(m,Y)[k],$=o(m,E)===pe?{}:{...o(m,E)};if(be==="*"){const F=o(m,O)["*"];F&&(s.push(...y(this,_,G).call(this,F,e,o(m,E))),d(F,E,$),v.push(F));continue}const[pt,Me,de]=be;if(!f&&!(de instanceof RegExp))continue;const D=o(m,O)[pt],gt=a.slice(l).join("/");if(de instanceof RegExp){const F=de.exec(gt);if(F){if($[Me]=F[0],s.push(...y(this,_,G).call(this,D,e,o(m,E),$)),Object.keys(o(D,O)).length){d(D,E,$);const De=((c=F[0].match(/\//))==null?void 0:c.length)??0;(h[De]||(h[De]=[])).push(D)}continue}}(de===!0||de.test(f))&&($[Me]=f,w?(s.push(...y(this,_,G).call(this,D,e,$,o(m,E))),o(D,O)["*"]&&s.push(...y(this,_,G).call(this,o(D,O)["*"],e,$,o(m,E)))):(d(D,E,$),v.push(D)))}}i=v.concat(h.shift()??[])}return s.length>1&&s.sort((l,u)=>l.score-u.score),[s.map(({handler:l,params:u})=>[l,u])]}},V=new WeakMap,O=new WeakMap,Y=new WeakMap,ue=new WeakMap,E=new WeakMap,_=new WeakSet,G=function(e,r,s,n){const i=[];for(let a=0,h=o(e,V).length;a<h;a++){const c=o(e,V)[a],l=c[r]||c[x],u={};if(l!==void 0&&(l.params=Object.create(null),i.push(l),s!==pe||n&&n!==pe))for(let f=0,w=l.possibleKeys.length;f<w;f++){const v=l.possibleKeys[f],P=u[l.score];l.params[v]=n!=null&&n[v]&&!P?n[v]:s[v]??(n==null?void 0:n[v]),u[l.score]=!0}}return i},fe),Z,Je,Qt=(Je=class{constructor(){p(this,"name","TrieRouter");g(this,Z);d(this,Z,new Jt)}add(t,e,r){const s=Ze(e);if(s){for(let n=0,i=s.length;n<i;n++)o(this,Z).insert(t,s[n],r);return}o(this,Z).insert(t,e,r)}match(t,e){return o(this,Z).search(t,e)}},Z=new WeakMap,Je),ft=class extends kt{constructor(t={}){super(t),this.router=t.router??new Xt({routers:[new Gt,new Qt]})}},Yt=t=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...t},s=(i=>typeof i=="string"?i==="*"?()=>i:a=>i===a?a:null:typeof i=="function"?i:a=>i.includes(a)?a:null)(r.origin),n=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(r.allowMethods);return async function(a,h){var u;function c(f,w){a.res.headers.set(f,w)}const l=await s(a.req.header("origin")||"",a);if(l&&c("Access-Control-Allow-Origin",l),r.credentials&&c("Access-Control-Allow-Credentials","true"),(u=r.exposeHeaders)!=null&&u.length&&c("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),a.req.method==="OPTIONS"){r.origin!=="*"&&c("Vary","Origin"),r.maxAge!=null&&c("Access-Control-Max-Age",r.maxAge.toString());const f=await n(a.req.header("origin")||"",a);f.length&&c("Access-Control-Allow-Methods",f.join(","));let w=r.allowHeaders;if(!(w!=null&&w.length)){const v=a.req.header("Access-Control-Request-Headers");v&&(w=v.split(/\s*,\s*/))}return w!=null&&w.length&&(c("Access-Control-Allow-Headers",w.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await h(),r.origin!=="*"&&a.header("Vary","Origin",{append:!0})}};const te=new ft;te.use("/api/*",Yt());te.get("/api/health",t=>t.json({status:"ok",timestamp:new Date().toISOString()}));te.get("/api/calls",t=>{const e=[{id:1,caller:"김철수",duration:"03:24",summary:"제품 가격 협상 진행, 계약 기간 연장 조건 제시",sentiment:"neutral",priority:"high",timestamp:"2024-01-06 14:30"},{id:2,caller:"이영희",duration:"01:45",summary:"배송 일정 확인, 목요일 오후 2시로 확정",sentiment:"positive",priority:"medium",timestamp:"2024-01-06 13:15"},{id:3,caller:"박민수",duration:"05:12",summary:"클레임 접수, 환불 요청 논의 중",sentiment:"negative",priority:"urgent",timestamp:"2024-01-06 11:20"}];return t.json({calls:e})});te.get("/api/negotiation/:sessionId",t=>{const e=t.req.param("sessionId");return t.json({sessionId:e,successProbability:.78,riskLevel:"low",recommendations:["가격 대신 계약 기간 조건 제안 권장","현재 협상 진행 속도 양호","상대방 만족도 상승 중"],keyInsights:{emotion:"neutral",intent:"가격 협상",urgency:"medium"}})});te.get("/api/industries",t=>{const e=[{id:"caregiver",name:"간병인",icon:"fa-user-nurse",features:["보호자 통화 자동 요약","응급 키워드 감지","일일 간병 리포트"]},{id:"construction",name:"건설현장",icon:"fa-hard-hat",features:["작업 중 통화 차단","안전 우선 모드","작업 지시 자동 정리"]},{id:"delivery",name:"택배기사",icon:"fa-truck",features:["배송 중 자동 응답","위치 문의 처리","분쟁 증빙 기록"]},{id:"business",name:"자영업",icon:"fa-store",features:["예약 자동 확인","주문 정보 처리","고객 문의 응답"]},{id:"freelancer",name:"프리랜서/영업",icon:"fa-briefcase",features:["클라이언트 통화 관리","계약 협상 지원","업무 자동화"]}];return t.json({industries:e})});te.get("/",t=>t.redirect("/lang/ko"));const Ke=new ft,Zt=Object.assign({"/src/index.tsx":te});let dt=!1;for(const[,t]of Object.entries(Zt))t&&(Ke.all("*",e=>{let r;try{r=e.executionCtx}catch{}return t.fetch(e.req.raw,e.env,r)}),Ke.notFound(e=>{let r;try{r=e.executionCtx}catch{}return t.fetch(e.req.raw,e.env,r)}),dt=!0);if(!dt)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{Ke as default};
